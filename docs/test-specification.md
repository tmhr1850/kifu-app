# 将棋アプリケーションテスト仕様書

## 1. テスト概要

### 1.1 目的
将棋アプリケーションの品質保証を行い、要件定義書に記載された機能が正しく動作することを確認する。

### 1.2 テスト範囲
- 機能テスト
- 非機能テスト（パフォーマンス、セキュリティ、ユーザビリティ）
- 統合テスト
- E2Eテスト

### 1.3 テスト環境
- **開発環境**: ローカル開発環境
- **ステージング環境**: Vercel Preview環境
- **本番環境**: Vercel Production環境

## 2. テスト戦略

### 2.1 テストレベル
1. **単体テスト (Unit Test)**
   - カバレッジ目標: 80%以上
   - テストフレームワーク: Jest, React Testing Library
2. **統合テスト (Integration Test)**
   - API通信テスト
   - コンポーネント間連携テスト
3. **E2Eテスト (End-to-End Test)**
   - 主要ユーザーフローの確認
   - テストフレームワーク: Playwright / Cypress

### 2.2 テスト種別
- **機能テスト**: 各機能が仕様通り動作するか確認
- **回帰テスト**: 修正・追加による既存機能への影響確認
- **受け入れテスト**: ユーザー要求を満たしているか確認

## 3. 機能テスト仕様

### 3.1 対局機能テスト

#### 3.1.1 ローカル対局テスト
| テストID | テスト項目 | 事前条件 | テスト手順 | 期待結果 | 優先度 |
|---------|----------|---------|----------|---------|-------|
| GM-001 | 新規対局開始 | ホーム画面表示 | 1. 「対局開始」ボタンクリック<br>2. 「ローカル対局」選択 | 対局画面に遷移し、初期配置で表示される | 高 |
| GM-002 | 駒の移動（歩） | 対局中 | 1. 先手の歩を選択<br>2. 一つ前のマスをクリック | 歩が正しく移動し、手番が後手に変わる | 高 |
| GM-003 | 駒の移動（飛車） | 対局中 | 1. 飛車を選択<br>2. 移動可能範囲を確認<br>3. 有効なマスをクリック | 移動可能マスがハイライト表示され、正しく移動する | 高 |
| GM-004 | 駒の成り | 敵陣に入れる状況 | 1. 歩を敵陣に移動<br>2. 成り確認ダイアログ表示 | 「成る」「成らない」の選択ができる | 高 |
| GM-005 | 王手判定 | 対局中 | 1. 相手玉に王手をかける | 王手警告が表示される | 高 |
| GM-006 | 詰み判定 | 詰み直前の局面 | 1. 詰み手を指す | 対局終了ダイアログが表示される | 高 |
| GM-007 | 投了 | 対局中 | 1. 「投了」ボタンクリック<br>2. 確認ダイアログで「はい」 | 対局が終了し、結果が表示される | 中 |
| GM-008 | 待った機能 | 対局中（2手以上進行） | 1. 「待った」ボタンクリック | 直前の手が取り消される | 中 |
| GM-009 | 千日手判定 | 同一局面3回 | 1. 同一局面を4回作る | 千日手の警告が表示される | 低 |

#### 3.1.2 AI対局テスト
| テストID | テスト項目 | 事前条件 | テスト手順 | 期待結果 | 優先度 |
|---------|----------|---------|----------|---------|-------|
| AI-001 | AI対局開始 | ホーム画面表示 | 1. 「対局開始」ボタンクリック<br>2. 「AI対局」選択<br>3. 難易度選択 | AI対局が開始される | 高 |
| AI-002 | AI思考時間 | AI対局中 | 1. プレイヤーが着手<br>2. AI思考時間を計測 | 設定した時間±10%以内でAIが着手 | 中 |
| AI-003 | AI難易度（初級） | 初級AI選択 | 1. 初級AIと対局<br>2. 明らかな悪手の確認 | 基本的な手は指すが、時々悪手を指す | 中 |
| AI-004 | AI難易度（上級） | 上級AI選択 | 1. 上級AIと対局<br>2. 戦略的な手の確認 | 理にかなった手を指し続ける | 中 |

#### 3.1.3 オンライン対局テスト
| テストID | テスト項目 | 事前条件 | テスト手順 | 期待結果 | 優先度 |
|---------|----------|---------|----------|---------|-------|
| ON-001 | マッチング | ログイン済み | 1. 「オンライン対局」選択<br>2. マッチング開始 | 対戦相手が見つかり対局開始 | 高 |
| ON-002 | リアルタイム同期 | オンライン対局中 | 1. プレイヤーAが着手<br>2. プレイヤーBの画面確認 | 即座に相手の手が反映される | 高 |
| ON-003 | 通信切断処理 | オンライン対局中 | 1. ネットワーク切断<br>2. 再接続 | 対局が復帰し、継続可能 | 高 |
| ON-004 | 時間切れ | 持ち時間あり | 1. 持ち時間を使い切る | 時間切れ負けとなる | 中 |

### 3.2 棋譜管理機能テスト

#### 3.2.1 棋譜保存テスト
| テストID | テスト項目 | 事前条件 | テスト手順 | 期待結果 | 優先度 |
|---------|----------|---------|----------|---------|-------|
| KF-001 | 自動保存 | 対局終了 | 1. 対局を最後まで行う<br>2. 棋譜一覧を確認 | 対局した棋譜が保存されている | 高 |
| KF-002 | 手動保存 | 対局中 | 1. 「保存」ボタンクリック<br>2. タイトル入力<br>3. 保存実行 | 途中局面が保存される | 高 |
| KF-003 | 棋譜情報編集 | 保存済み棋譜 | 1. 棋譜を選択<br>2. 編集ボタンクリック<br>3. 情報を変更 | 棋譜情報が更新される | 中 |

#### 3.2.2 棋譜インポート/エクスポートテスト
| テストID | テスト項目 | 事前条件 | テスト手順 | 期待結果 | 優先度 |
|---------|----------|---------|----------|---------|-------|
| KF-004 | KIFインポート | KIFファイル準備 | 1. インポートボタンクリック<br>2. KIFファイル選択 | 棋譜が正しく読み込まれる | 高 |
| KF-005 | CSAインポート | CSAファイル準備 | 1. インポートボタンクリック<br>2. CSAファイル選択 | 棋譜が正しく読み込まれる | 中 |
| KF-006 | KIFエクスポート | 保存済み棋譜 | 1. 棋譜を選択<br>2. エクスポート実行 | KIF形式でダウンロードされる | 高 |
| KF-007 | 不正形式エラー | 不正なファイル | 1. 不正な形式のファイルを選択 | エラーメッセージが表示される | 中 |

### 3.3 棋譜再生・分析機能テスト

#### 3.3.1 再生機能テスト
| テストID | テスト項目 | 事前条件 | テスト手順 | 期待結果 | 優先度 |
|---------|----------|---------|----------|---------|-------|
| RP-001 | 一手進む/戻る | 棋譜読み込み済み | 1. 「進む」ボタンクリック<br>2. 「戻る」ボタンクリック | 正しく局面が変化する | 高 |
| RP-002 | 自動再生 | 棋譜読み込み済み | 1. 「自動再生」ボタンクリック<br>2. 速度変更 | 設定速度で自動再生される | 中 |
| RP-003 | 特定手数へジャンプ | 棋譜読み込み済み | 1. 手数を指定<br>2. ジャンプ実行 | 指定手数の局面が表示される | 中 |

#### 3.3.2 分析機能テスト
| テストID | テスト項目 | 事前条件 | テスト手順 | 期待結果 | 優先度 |
|---------|----------|---------|----------|---------|-------|
| AN-001 | コメント追加 | 棋譜再生中 | 1. コメント入力<br>2. 保存 | 該当手にコメントが保存される | 中 |
| AN-002 | 変化手順追加 | 棋譜再生中 | 1. 分岐点で別の手を指す<br>2. 変化として保存 | 分岐が作成される | 中 |
| AN-003 | 局面評価表示 | AI分析有効 | 1. AI分析を実行 | 各手の評価値が表示される | 低 |

### 3.4 ユーザー管理機能テスト

#### 3.4.1 認証テスト
| テストID | テスト項目 | 事前条件 | テスト手順 | 期待結果 | 優先度 |
|---------|----------|---------|----------|---------|-------|
| AU-001 | 新規登録 | 未登録 | 1. 登録フォーム入力<br>2. メール認証 | アカウントが作成される | 高 |
| AU-002 | ログイン | 登録済み | 1. ID/パスワード入力<br>2. ログイン実行 | ログインし、ホーム画面へ遷移 | 高 |
| AU-003 | ソーシャルログイン | Googleアカウント | 1. Googleログイン選択<br>2. 認証 | Googleアカウントでログイン | 中 |
| AU-004 | パスワードリセット | 登録済み | 1. パスワード忘れリンク<br>2. メール送信<br>3. リセット実行 | パスワードが変更される | 中 |

## 4. 非機能テスト仕様

### 4.1 パフォーマンステスト
| テストID | テスト項目 | 測定内容 | 合格基準 | 優先度 |
|---------|----------|---------|---------|-------|
| PF-001 | 初期表示速度 | ホーム画面表示時間 | 2秒以内 | 高 |
| PF-002 | 着手レスポンス | クリックから反映まで | 100ms以内 | 高 |
| PF-003 | 大量棋譜表示 | 1000件の棋譜一覧 | 3秒以内 | 中 |
| PF-004 | 同時接続数 | 最大同時接続ユーザー数 | 1000ユーザー | 中 |

### 4.2 セキュリティテスト
| テストID | テスト項目 | テスト内容 | 期待結果 | 優先度 |
|---------|----------|---------|---------|-------|
| SC-001 | SQLインジェクション | 悪意のあるSQL文入力 | エラー処理され、実行されない | 高 |
| SC-002 | XSS対策 | スクリプトタグ入力 | サニタイズされて表示 | 高 |
| SC-003 | 認証バイパス | 直接URL入力 | ログイン画面へリダイレクト | 高 |
| SC-004 | HTTPS通信 | 通信内容確認 | 全通信が暗号化されている | 高 |

### 4.3 ユーザビリティテスト
| テストID | テスト項目 | テスト内容 | 合格基準 | 優先度 |
|---------|----------|---------|----------|-------|
| US-001 | レスポンシブ対応 | 各デバイスサイズで表示 | 正しくレイアウトされる | 高 |
| US-002 | タッチ操作 | スマホでの駒移動 | スムーズに操作できる | 高 |
| US-003 | キーボード操作 | Tab移動、Enter選択 | 全機能が操作可能 | 中 |
| US-004 | エラーメッセージ | 各種エラー発生 | 分かりやすいメッセージ | 中 |

### 4.4 ブラウザ互換性テスト
| テストID | ブラウザ | バージョン | テスト結果 | 備考 |
|---------|---------|----------|----------|-----|
| BR-001 | Chrome | 最新版 | - | 推奨環境 |
| BR-002 | Firefox | 最新版 | - | - |
| BR-003 | Safari | 最新版 | - | - |
| BR-004 | Edge | 最新版 | - | - |

## 5. テスト実施計画

### 5.1 テストスケジュール
1. **Phase 1完了時**
   - 単体テスト: 対局機能の基本動作
   - 統合テスト: 画面遷移
2. **Phase 2完了時**
   - 単体テスト: 棋譜管理機能
   - 統合テスト: データ永続化
3. **Phase 3完了時**
   - E2Eテスト: オンライン対局フロー
   - パフォーマンステスト
4. **Phase 4完了時**
   - AI機能テスト
   - 負荷テスト
5. **Phase 5**
   - 受け入れテスト
   - セキュリティテスト
   - 回帰テスト

### 5.2 テスト自動化方針
- **自動化対象**
  - 単体テスト: 100%自動化
  - 統合テスト: 主要フローの80%を自動化
  - E2Eテスト: 主要シナリオの60%を自動化
- **手動テスト対象**
  - ユーザビリティテスト
  - 探索的テスト
  - 受け入れテスト

## 6. バグ管理

### 6.1 優先度定義
- **Critical**: システムが使用不可、データ損失の可能性
- **High**: 主要機能が動作しない
- **Medium**: 機能は動作するが期待通りでない
- **Low**: 軽微な表示崩れ、改善要望

### 6.2 バグ報告フォーマット
```
【発生日時】
【環境】OS/ブラウザ/バージョン
【再現手順】
1. 
2. 
3. 
【期待結果】
【実際の結果】
【スクリーンショット】
【優先度】Critical/High/Medium/Low
```

## 7. テスト完了基準

### 7.1 定量的基準
- 単体テストカバレッジ: 80%以上
- Criticalバグ: 0件
- Highバグ: 5件以下
- 全テストケース実施率: 95%以上

### 7.2 定性的基準
- 主要ユーザーシナリオが問題なく実行できる
- パフォーマンス要件を満たしている
- セキュリティ脆弱性が発見されていない

## 8. リスクと対策

### 8.1 テストリスク
| リスク | 影響度 | 発生確率 | 対策 |
|-------|-------|---------|-----|
| テスト環境の不具合 | 高 | 中 | 複数環境の準備、定期メンテナンス |
| テストデータ不足 | 中 | 中 | テストデータ生成ツールの準備 |
| テスト期間の遅延 | 高 | 中 | バッファ期間の確保、優先度付け |
| 自動テストの保守コスト | 中 | 高 | Page Objectパターンの採用 |

## 9. 付録

### 9.1 テストデータ
- 正常系テストデータセット
- 異常系テストデータセット
- 境界値テストデータセット
- 棋譜サンプルファイル（KIF/CSA形式）

### 9.2 テストツール
- **単体テスト**: Jest, React Testing Library
- **E2Eテスト**: Playwright / Cypress
- **パフォーマンステスト**: Lighthouse, WebPageTest
- **負荷テスト**: k6 / Apache JMeter
- **セキュリティテスト**: OWASP ZAP

### 9.3 参考資料
- 将棋連盟公式ルール
- KIF/CSA形式仕様書
- WCAG 2.1ガイドライン
- Next.js公式ドキュメント