# 将棋アプリケーション要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
kifu-app（棋譜アプリ）

### 1.2 目的
本プロジェクトは、将棋の対局、棋譜の記録・管理、および学習支援を提供するWebアプリケーションの開発を目的とします。

### 1.3 開発手法
**テスト駆動開発（TDD）** を採用し、以下の開発サイクルに従います：
1. **Red**: 失敗するテストを書く
2. **Green**: テストを通過する最小限のコードを書く
3. **Refactor**: コードをリファクタリングして品質を向上させる

### 1.4 技術スタック
- **フロントエンド**: 
  - Next.js 15.3.3 (App Router)
  - TypeScript (厳密モード有効)
  - React 19.0.0
  - Tailwind CSS v4
- **テスティング**:
  - Jest (単体テスト)
  - React Testing Library (コンポーネントテスト)
  - Playwright (E2Eテスト)
- **開発ツール**:
  - ESLint (Next.js Core Web Vitals設定)
  - Prettier
  - Husky (pre-commitフック)
- **デプロイメント**:
  - Vercel (本番環境)
  - Playground MCP (開発確認用)

## 2. 機能要件

### 2.1 対局機能

#### 2.1.1 人間対人間
- ローカル対局（同一デバイス）
- オンライン対局（リアルタイム通信）
- 持ち時間管理

#### 2.1.2 人間対AI
- AI難易度設定（初級・中級・上級）
- AI思考時間の調整
- ヒント機能

#### 2.1.3 対局ルール
- 標準将棋ルールの完全実装
- 千日手・持将棋の判定
- 投了・中断機能

### 2.2 棋譜管理機能

#### 2.2.1 棋譜記録
- リアルタイム棋譜記録
- KIF/KI2形式での保存
- CSA形式での保存

#### 2.2.2 棋譜再生
- 手順の再生・巻き戻し
- 分岐棋譜の管理
- コメント・評価値の表示

#### 2.2.3 棋譜インポート/エクスポート
- ファイルアップロード機能
- クラウド同期
- 共有URL生成

### 2.3 分析機能

#### 2.3.1 局面解析
- 形勢判断表示
- 次の一手候補表示
- 悪手・好手の指摘

#### 2.3.2 統計情報
- 対局成績の記録
- 戦型別勝率
- 時間使用パターン分析

### 2.4 ユーザー管理

#### 2.4.1 認証
- メールアドレス認証
- ソーシャルログイン（Google、GitHub）
- パスワードリセット機能

#### 2.4.2 プロフィール
- ユーザー情報管理
- アバター設定
- 実績・称号システム

### 2.5 UI/UX要件

#### 2.5.1 レスポンシブデザイン
- モバイル、タブレット、デスクトップ対応
- タッチ操作対応
- キーボードショートカット

#### 2.5.2 アクセシビリティ
- WCAG 2.1 AA準拠
- スクリーンリーダー対応
- キーボードナビゲーション

#### 2.5.3 国際化
- 日本語・英語対応
- 棋譜記法の切り替え

## 3. 非機能要件

### 3.1 パフォーマンス
- 初期読み込み時間: 3秒以内
- ページ遷移: 1秒以内
- 対局中の応答時間: 100ms以内
- Lighthouse スコア: 90以上

### 3.2 セキュリティ
- HTTPS通信の強制
- XSS対策（Content Security Policy）
- CSRF対策
- SQLインジェクション対策
- 認証トークンの安全な管理

### 3.3 可用性
- 99.9%のアップタイム
- エラー監視とロギング
- 自動バックアップ（日次）

### 3.4 拡張性
- マイクロサービスアーキテクチャ
- 水平スケーリング対応
- APIファースト設計

## 4. TDD実装戦略

### 4.1 テストピラミッド
1. **単体テスト (70%)**
   - ビジネスロジック（将棋ルール、棋譜処理）
   - ユーティリティ関数
   - カスタムフック

2. **統合テスト (20%)**
   - APIエンドポイント
   - データベース操作
   - 外部サービス連携

3. **E2Eテスト (10%)**
   - ユーザーシナリオ
   - クリティカルパス
   - ブラウザ互換性

### 4.2 テストカバレッジ目標
- 全体: 80%以上
- ビジネスロジック: 95%以上
- UIコンポーネント: 70%以上

### 4.3 CI/CDパイプライン
1. プルリクエスト時:
   - 全テストスイートの実行
   - コードカバレッジレポート
   - ESLint/Prettier チェック

2. メインブランチマージ時:
   - ステージング環境へのデプロイ
   - E2Eテストの実行
   - パフォーマンステスト

## 5. Playground MCP統合

### 5.1 開発環境確認
- ローカル開発サーバーとの統合
- リアルタイムプレビュー
- ホットリロード対応

### 5.2 デバッグ機能
- React DevTools統合
- ネットワークリクエスト監視
- パフォーマンスプロファイリング

### 5.3 共有機能
- 開発中の画面をチームで共有
- フィードバック機能
- スクリーンショット自動保存

## 6. 開発フェーズ

### Phase 1: 基盤構築（4週間）
- プロジェクトセットアップ
- CI/CD環境構築
- 基本的なUIコンポーネント作成
- 認証システムの実装

### Phase 2: コア機能開発（8週間）
- 将棋盤UIの実装
- 駒の移動ロジック
- ルール判定システム
- 基本的な対局機能

### Phase 3: 棋譜機能（4週間）
- 棋譜記録・再生機能
- インポート/エクスポート
- 棋譜データベース設計

### Phase 4: AI・分析機能（6週間）
- AI対戦機能
- 局面解析
- 統計機能

### Phase 5: 最終調整（4週間）
- E2Eテスト完成
- パフォーマンス最適化
- セキュリティ監査
- ドキュメント整備

## 7. 成果物

### 7.1 ソースコード
- TypeScriptで記述された本番コード
- 包括的なテストスイート
- Storybook によるコンポーネントカタログ

### 7.2 ドキュメント
- API仕様書
- アーキテクチャ設計書
- ユーザーマニュアル
- 開発者ガイド

### 7.3 デプロイメント
- 本番環境（Vercel）
- ステージング環境
- Playground MCP確認環境

## 8. 制約事項

### 8.1 技術的制約
- ブラウザサポート: Chrome、Firefox、Safari、Edge（最新2バージョン）
- Node.js: 18.x以上
- TypeScript: 厳密モード必須

### 8.2 リソース制約
- 初期リリースまで: 6ヶ月
- 開発チーム: 3-5名
- インフラコスト: 月額$500以内

## 9. リスクと対策

### 9.1 技術的リスク
- **リスク**: 将棋AIの計算負荷
- **対策**: Web Workerを使用した並列処理

### 9.2 スケジュールリスク
- **リスク**: E2Eテストの作成遅延
- **対策**: 早期からE2Eテストを段階的に追加

### 9.3 品質リスク
- **リスク**: ブラウザ間の互換性問題
- **対策**: 継続的なクロスブラウザテスト

## 10. 承認

本要件定義書は、TDD手法に基づいた高品質な将棋アプリケーションの開発を保証します。全ての要件は、テスト可能な形で定義されており、継続的な品質向上が可能な設計となっています。